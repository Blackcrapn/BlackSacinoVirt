<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black Win | Crimson Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;700&display=swap');
        
        :root {
            --primary: #ff0000;
            --primary-dark: #8b0000;
            --bg: #0a0a0a;
            --card: #151515;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg);
            color: #fff;
            overflow-x: hidden;
        }

        .font-game { font-family: 'Orbitron', sans-serif; }

        .glass-red {
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid rgba(255, 0, 0, 0.1);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.05);
        }

        .btn-red {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: #fff;
            font-weight: 800;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .btn-red:active { transform: scale(0.92); filter: brightness(1.2); }

        .nav-active { color: var(--primary) !important; text-shadow: 0 0 10px var(--primary); }

        .progress-red {
            background: linear-gradient(90deg, #ff0000, #ff4d4d);
            box-shadow: 0 0 10px #ff0000;
            transition: width 0.5s ease;
        }

        .case-anim { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .hidden-section { display: none; }
    </style>
</head>
<body class="pb-24">

    <div id="auth-screen" class="fixed inset-0 z-[200] bg-black flex items-center justify-center p-6 hidden">
        <div class="glass-red p-8 rounded-[30px] w-full max-w-sm text-center">
            <h1 class="font-game text-3xl font-black text-red-600 mb-6">BLACK WIN</h1>
            <input type="email" id="auth-email" placeholder="Email" class="w-full bg-neutral-900 border border-red-900/30 p-4 rounded-xl mb-4 focus:outline-none focus:border-red-600">
            <input type="password" id="auth-password" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full bg-neutral-900 border border-red-900/30 p-4 rounded-xl mb-6 focus:outline-none focus:border-red-600">
            <button onclick="handleAuth('login')" class="btn-red w-full py-4 rounded-xl mb-3">–í–æ–π—Ç–∏</button>
            <button onclick="handleAuth('signup')" class="text-xs text-neutral-500 uppercase tracking-widest hover:text-red-500">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </div>
    </div>

    <div id="msg-modal" class="fixed inset-0 z-[300] flex items-center justify-center bg-black/90 hidden opacity-0 transition-opacity duration-300">
        <div class="glass-red p-10 rounded-[40px] text-center max-w-sm w-full animate__animated">
            <h2 id="msg-status" class="font-game text-4xl font-black mb-2 uppercase">WIN</h2>
            <p id="msg-text" class="text-xl font-bold mb-8">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ 5,000 BC</p>
            <button onclick="closeMsg()" class="btn-red px-12 py-4 rounded-2xl">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <header class="p-6 flex justify-between items-center sticky top-0 z-50 bg-black/80 backdrop-blur-xl border-b border-red-900/20">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-red-600 rounded-lg flex items-center justify-center font-game font-black text-black">BW</div>
            <div>
                <h1 class="font-game text-xl font-black tracking-tighter uppercase leading-none">Black Win</h1>
                <p id="ui-username" class="text-[9px] text-red-500 font-bold uppercase tracking-widest mt-1 italic">Guest_User</p>
            </div>
        </div>
        <div class="text-right">
            <div id="ui-balance" class="font-game text-xl font-black text-white">0 BC</div>
            <div id="ui-multiplier" class="text-[10px] text-red-500 font-black uppercase">Multiplier: x1.0</div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto p-4 space-y-6">

        <div id="sec-games" class="space-y-6">
            <div class="glass-red p-6 rounded-[35px] relative overflow-hidden group cursor-pointer" onclick="showSection('pass')">
                <div class="flex justify-between items-end mb-4 relative z-10">
                    <div>
                        <p class="text-[10px] font-black text-red-500 uppercase">Season 1</p>
                        <h2 class="font-game text-2xl font-black italic">BLACK PASS</h2>
                    </div>
                    <div class="text-right">
                        <span class="text-xs font-bold">LVL <span id="ui-lvl">1</span></span>
                    </div>
                </div>
                <div class="w-full bg-neutral-900 h-3 rounded-full overflow-hidden relative z-10">
                    <div id="ui-pass-bar" class="progress-red h-full" style="width: 0%"></div>
                </div>
                <div class="absolute right-[-20px] top-[-20px] text-8xl font-black text-red-600/5 italic select-none">LEVEL</div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass-red p-8 rounded-[40px] flex flex-col items-center">
                    <h3 class="font-game text-lg mb-6 self-start italic">Higher or Lower</h3>
                    <div class="w-full bg-neutral-900/50 py-12 rounded-[35px] border border-red-900/10 text-center mb-8">
                        <span id="hl-number" class="font-game text-8xl font-black text-red-600 tracking-tighter">?</span>
                    </div>
                    
                    <div id="hl-init-btns" class="w-full space-y-3">
                        <div class="flex gap-2 mb-2">
                             <input type="number" id="hl-bet" value="500" min="500" class="flex-1 bg-neutral-900 border border-red-900/30 p-4 rounded-2xl text-center font-bold focus:outline-none">
                        </div>
                        <button onclick="startHL()" class="btn-red w-full py-5 rounded-[25px]">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                    </div>

                    <div id="hl-game-btns" class="w-full hidden flex gap-4">
                        <button onclick="playHL('high')" class="flex-1 btn-red py-5 rounded-[25px]">–ë–æ–ª—å—à–µ</button>
                        <button onclick="playHL('low')" class="flex-1 bg-white/5 border border-white/10 font-bold py-5 rounded-[25px]">–ú–µ–Ω—å—à–µ</button>
                    </div>
                </div>

                <div class="glass-red p-8 rounded-[40px]">
                    <h3 class="font-game text-lg mb-4 italic">PVP Dice Online</h3>
                    <p class="text-xs text-neutral-400 mb-6">–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –∏–≥—Ä–æ–∫–∞, —á—Ç–æ–±—ã –±—Ä–æ—Å–∏—Ç—å –≤—ã–∑–æ–≤. –°—Ç–∞–≤–∫–∏ —Ä–∞–≤–Ω—ã.</p>
                    <div class="space-y-4">
                        <input type="text" id="pvp-target" placeholder="–ù–∏–∫–Ω–µ–π–º –¥—Ä—É–≥–∞..." class="w-full bg-neutral-900 border border-red-900/30 p-4 rounded-2xl focus:outline-none focus:border-red-600">
                        <button class="btn-red w-full py-5 rounded-[25px]">–ù–∞–π—Ç–∏ –∏–≥—Ä–æ–∫–∞</button>
                        <div class="p-4 bg-red-600/5 rounded-2xl border border-red-600/10 text-center">
                            <p class="text-[10px] text-red-500 font-bold uppercase">–°—Ç–∞—Ç—É—Å</p>
                            <p class="text-sm">–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="sec-cases" class="hidden-section space-y-8 animate__animated animate__fadeIn">
            <h2 class="font-game text-3xl font-black text-center">STORE <span class="text-red-600">&</span> CASES</h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                <div class="glass-red p-6 rounded-[35px] text-center border-b-4 border-orange-900">
                    <div class="text-5xl mb-4 case-anim">üì¶</div>
                    <h4 class="font-bold mb-1">Wood Case</h4>
                    <p class="text-[10px] text-neutral-500 mb-4">Price: 5,000 BC</p>
                    <button onclick="buyCase('wood')" class="btn-red w-full py-3 rounded-xl text-xs">–û—Ç–∫—Ä—ã—Ç—å</button>
                </div>
                <div class="glass-red p-6 rounded-[35px] text-center border-b-4 border-red-600 bg-red-600/5">
                    <div class="text-5xl mb-4 case-anim">üî•</div>
                    <h4 class="font-bold mb-1">Elite Case</h4>
                    <p class="text-[10px] text-neutral-500 mb-4">Price: 50,000 BC</p>
                    <button onclick="buyCase('elite')" class="btn-red w-full py-3 rounded-xl text-xs">–û—Ç–∫—Ä—ã—Ç—å</button>
                </div>
                <div class="glass-red p-6 rounded-[35px] text-center border-b-4 border-white bg-white/5">
                    <div class="text-5xl mb-4 case-anim">üíé</div>
                    <h4 class="font-bold mb-1">Black Win</h4>
                    <p class="text-[10px] text-neutral-500 mb-4">Price: 500,000 BC</p>
                    <button onclick="buyCase('black')" class="btn-red w-full py-3 rounded-xl text-xs">–û—Ç–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>

        <div id="sec-bank" class="hidden-section max-w-md mx-auto animate__animated animate__fadeIn">
            <div class="glass-red p-8 rounded-[40px] text-center">
                <h2 class="font-game text-2xl mb-6">üè¶ GLOBAL BANK</h2>
                <div class="bg-neutral-900 p-6 rounded-3xl mb-8">
                    <p class="text-xs text-neutral-500 uppercase mb-2">–í —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</p>
                    <p id="ui-bank-balance" class="text-4xl font-game font-black text-red-600">0 BC</p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="bankAction('dep')" class="btn-red py-4 rounded-2xl">–ü–æ–ª–æ–∂–∏—Ç—å</button>
                    <button onclick="bankAction('with')" class="bg-white/5 border border-white/10 py-4 rounded-2xl font-bold">–°–Ω—è—Ç—å</button>
                </div>
            </div>
        </div>

    </main>

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[92%] max-w-lg glass-red p-2 rounded-[35px] flex justify-around items-center z-50">
        <button onclick="showSection('games')" id="nav-games" class="nav-active flex flex-col items-center p-3">
            <span class="text-xl">üéÆ</span><span class="text-[8px] font-black uppercase mt-1">Games</span>
        </button>
        <button onclick="showSection('cases')" id="nav-cases" class="text-neutral-500 flex flex-col items-center p-3">
            <span class="text-xl">üéÅ</span><span class="text-[8px] font-black uppercase mt-1">Store</span>
        </button>
        <button onclick="showSection('bank')" id="nav-bank" class="text-neutral-500 flex flex-col items-center p-3">
            <span class="text-xl">üè¶</span><span class="text-[8px] font-black uppercase mt-1">Bank</span>
        </button>
        <button onclick="showSection('friends')" id="nav-friends" class="text-neutral-500 flex flex-col items-center p-3">
            <span class="text-xl">üë•</span><span class="text-[8px] font-black uppercase mt-1">Social</span>
        </button>
    </nav>

    <script>
        // --- SUPABASE CONFIG ---
        const SB_URL = 'https://xlrzjpzcqnjdtbuuovvz.supabase.co';
        const SB_KEY = 'sb_publishable_SOBMj961ujDu2G45dNor9g_CsjOu_JD';
        const supabase = window.supabase.createClient(SB_URL, SB_KEY);

        let user = null;
        let hlBase = 0;

        // --- AUTH LOGIC ---
        async function checkSession() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                loadProfile(session.user.id);
            } else {
                document.getElementById('auth-screen').classList.remove('hidden');
            }
        }

        async function handleAuth(type) {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-password').value;
            
            let res;
            if (type === 'login') res = await supabase.auth.signInWithPassword({ email, password: pass });
            else res = await supabase.auth.signUp({ email, password: pass });

            if (res.error) alert(res.error.message);
            else window.location.reload();
        }

        // --- CORE LOGIC ---
        async function loadProfile(id) {
            const { data } = await supabase.from('profiles').select('*').eq('id', id).single();
            if (data) {
                user = data;
                document.getElementById('auth-screen').classList.add('hidden');
                updateUI();
            }
        }

        function updateUI() {
            document.getElementById('ui-balance').innerText = user.balance.toLocaleString() + ' BC';
            document.getElementById('ui-username').innerText = user.username || 'Player_Samir';
            document.getElementById('ui-bank-balance').innerText = user.bank_balance.toLocaleString() + ' BC';
            document.getElementById('ui-multiplier').innerText = `Multiplier: x${user.multiplier.toFixed(1)}`;
            
            // Black Pass Logic
            const lvl = Math.floor(user.xp / 1000) + 1;
            const prog = (user.xp % 1000) / 10;
            document.getElementById('ui-lvl').innerText = lvl;
            document.getElementById('ui-pass-bar').style.width = prog + '%';
        }

        // --- UI NAVIGATION ---
        function showSection(name) {
            const sections = ['games', 'cases', 'bank', 'friends'];
            sections.forEach(s => {
                document.getElementById('sec-' + s)?.classList.add('hidden-section');
                document.getElementById('nav-' + s)?.classList.remove('nav-active');
                document.getElementById('nav-' + s)?.classList.add('text-neutral-500');
            });
            document.getElementById('sec-' + name)?.classList.remove('hidden-section');
            document.getElementById('nav-' + name)?.classList.add('nav-active');
        }

        // --- NOTIFICATIONS ---
        function notify(status, text) {
            const modal = document.getElementById('msg-modal');
            document.getElementById('msg-status').innerText = status;
            document.getElementById('msg-status').className = `font-game text-4xl font-black mb-2 uppercase ${status === 'WIN' ? 'text-red-600' : 'text-white'}`;
            document.getElementById('msg-text').innerText = text;
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.remove('opacity-0'), 10);
        }

        function closeMsg() {
            const modal = document.getElementById('msg-modal');
            modal.classList.add('opacity-0');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }

        // --- HIGHER LOWER (FIXED RANDOM) ---
        function startHL() {
            hlBase = Math.floor(Math.random() * 80) + 10;
            document.getElementById('hl-number').innerText = hlBase;
            document.getElementById('hl-init-btns').classList.add('hidden');
            document.getElementById('hl-game-btns').classList.remove('hidden');
        }

        async function playHL(choice) {
            const bet = parseInt(document.getElementById('hl-bet').value);
            if (user.balance < bet) return notify('ERROR', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ BC');

            // –ü–û–õ–ù–´–ô –†–ê–ù–î–û–ú: –ß–∏—Å–ª–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è
            const next = Math.floor(Math.random() * 100) + 1;
            if (next === hlBase) return playHL(choice); // –ü–µ—Ä–µ–±—Ä–æ—Å –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏

            const win = (choice === 'high' && next > hlBase) || (choice === 'low' && next < hlBase);
            const winAmount = Math.floor(bet * user.multiplier);
            
            const newBalance = win ? user.balance + winAmount : user.balance - bet;
            
            notify(win ? 'WIN' : 'LOSS', win ? `–í—ã–ø–∞–ª–æ ${next}! +${winAmount} BC` : `–í—ã–ø–∞–ª–æ ${next}! -${bet} BC`);

            const { data } = await supabase.from('profiles').update({ 
                balance: newBalance,
                xp: user.xp + 50 
            }).eq('id', user.id).select().single();
            
            user = data;
            updateUI();
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
            document.getElementById('hl-number').innerText = '?';
            document.getElementById('hl-init-btns').classList.remove('hidden');
            document.getElementById('hl-game-btns').classList.add('hidden');
        }

        // --- CASE OPENING ---
        async function buyCase(type) {
            const prices = { wood: 5000, elite: 50000, black: 500000 };
            if (user.balance < prices[type]) return notify('ERROR', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ BC');

            let win;
            if (type === 'wood') win = Math.floor(Math.random() * 12000);
            if (type === 'elite') win = Math.floor(Math.random() * 150000);
            if (type === 'black') win = Math.floor(Math.random() * 2000000);

            const newBalance = user.balance - prices[type] + win;
            notify(win > prices[type] ? 'WIN' : 'LOSS', `–ò–∑ –∫–µ–π—Å–∞ –≤—ã–ø–∞–ª–æ: ${win} BC`);

            const { data } = await supabase.from('profiles').update({ balance: newBalance, xp: user.xp + 200 }).eq('id', user.id).select().single();
            user = data;
            updateUI();
        }

        // --- BANK LOGIC ---
        async function bankAction(type) {
            const amount = parseInt(prompt("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É:"));
            if (!amount || amount <= 0) return;

            let newBal = user.balance;
            let newBank = user.bank_balance;

            if (type === 'dep') {
                if (user.balance < amount) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
                newBal -= amount;
                newBank += amount;
            } else {
                if (user.bank_balance < amount) return alert("–í –±–∞–Ω–∫–µ –Ω–µ—Ç —Ç–∞–∫–æ–π —Å—É–º–º—ã");
                newBal += amount;
                newBank -= amount;
            }

            const { data } = await supabase.from('profiles').update({ balance: newBal, bank_balance: newBank }).eq('id', user.id).select().single();
            user = data;
            updateUI();
        }

        checkSession();
    </script>
</body>
</html>
